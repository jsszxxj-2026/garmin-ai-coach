# GarminCoach — Cursor 项目规则

## 项目简介
基于 Garmin 数据与 Google Gemini 的跑步教练应用。FastAPI 后端，从 Garmin Connect 拉取睡眠、心率、活动与分段数据，经 LLM 分析后给出恢复评估与训练建议。

## 技术栈
- Python 3.9+
- FastAPI, Uvicorn
- Pydantic / pydantic-settings（配置）
- garminconnect（Garmin API，底层 garth）
- google-generativeai（Gemini）
- 同步 Garmin 客户端；LLM 调用为同步

## 目录结构
```
src/
  main.py           # FastAPI 入口
  core/config.py    # Settings（GARMIN_EMAIL, GARMIN_PASSWORD, GEMINI_API_KEY, GARMIN_IS_CN）
  services/         # 业务：garmin_service, llm_service
  models/           # 数据模型（预留）
scripts/            # 独立可执行脚本，需将项目根加入 sys.path
```

## 代码约定
- 使用 `python3`、`pip3`（本机无 `python`/`pip` 时）。运行脚本前激活 venv 或使用 `./venv/bin/python3`。
- 配置仅从 `src.core.config.settings` 读取；新增配置用 Pydantic Settings，`extra = "ignore"`。
- Garmin 中国区：`Garmin(..., is_cn=settings.GARMIN_IS_CN)`；`get_activities_by_date`、`get_user_summary`、`get_sleep_data`、`get_activity_splits` 等为同步。
- 服务类：`GarminService(email, password)` 在 `__init__` 中 `login()`；`LLMService()` 从 settings 读 `GEMINI_API_KEY` 并 `genai.configure(api_key=...)`。
- 异常：业务逻辑做 try/except，向脚本或 API 返回清晰错误信息，不吞掉异常。
- 类型：尽量使用 `typing`（`Dict`, `List`, `Optional` 等）标注关键参数与返回值。

## 运行与测试
- 安装：`python3 -m venv venv` → `source venv/bin/activate` → `pip3 install -r requirements.txt`
- 环境：复制 `.env.example` 为 `.env`，填写 GARMIN_EMAIL、GARMIN_PASSWORD、GEMINI_API_KEY；中国区加 `GARMIN_IS_CN=true`。
- 脚本：`./venv/bin/python3 scripts/test_garmin_auth.py`（Garmin 连通性），`./venv/bin/python3 scripts/test_coach.py`（日报 + AI 分析）。
- API：`uvicorn src.main:app --reload`，文档 `/docs`。

## 与 Cursor 协作时的偏好
- 新增接口或服务时，保持与现有 `GarminService`、`LLMService` 风格一致；脚本放在 `scripts/`，可复用相同的 `sys.path` 与 `from src...` 导入方式。
- 修改 `config.py` 或 `.env.example` 时，同步更新本文件中的配置说明。
- 涉及 Garmin 新 API 时，以 `garminconnect` 库现有方法为准；若需 `is_cn`，务必传入 `settings.GARMIN_IS_CN`。
